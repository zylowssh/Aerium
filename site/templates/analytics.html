{% extends "base.html" %} {% block content %}

<section class="card">
  <h2>ðŸ“ˆ Historique & Analyses</h2>
  <p class="hint">
    Analysez vos donnÃ©es Aerium ou importez un fichier CSV externe (analyse
    temporaire).
  </p>

  <!-- DATA SOURCE -->
  <div class="analytics-toolbar">
    <div class="data-source-switch">
      <button id="use-aerium" class="active">DonnÃ©es Aerium</button>
      <button id="use-csv">Importer CSV</button>
    </div>

    <div class="analytics-period">
      <label for="aerium-range" style="margin-right: 8px;">PÃ©riode</label>
      <select id="aerium-range">
        <option value="today">Aujourd'hui</option>
        <option value="7d">7 jours</option>
        <option value="30d">30 jours</option>
        <option value="custom">PersonnalisÃ©</option>
      </select>
    </div>

    <div id="custom-range" style="display: none; margin-left: 8px;">
      <input type="date" id="range-from" style="padding: 6px 8px; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; background: var(--card); color: var(--text); font-size: 0.9rem;" />
      <span style="color: var(--muted); margin: 0 6px;">-</span>
      <input type="date" id="range-to" style="padding: 6px 8px; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; background: var(--card); color: var(--text); font-size: 0.9rem;" />
      <button id="apply-range" class="link" style="padding: 6px 12px; margin-left: 8px;">Appliquer</button>
    </div>
  </div>

  <div id="csv-upload" class="csv-drop hidden">
    <input type="file" id="csv-file" accept=".csv" />
    <p style="cursor: pointer; margin: 0;">Glissez un CSV ou cliquez pour importer</p>
    <p style="font-size: 0.75rem; color: var(--muted); margin-top: 4px;">Analyse temporaire â€” non sauvegardÃ©e</p>
  </div>
</section>

<!-- METRICS -->
<section class="card">
  <h2>MÃ©triques</h2>
  <div class="analytics-metrics">
    <div class="metric">
      <span class="label">Moyenne</span>
      <span class="value" id="m-avg">â€”</span>
    </div>
    <div class="metric">
      <span class="label">Minimum</span>
      <span class="value" id="m-min">â€”</span>
    </div>
    <div class="metric">
      <span class="label">Maximum</span>
      <span class="value" id="m-max">â€”</span>
    </div>
    <div class="metric">
      <span class="label">Temps air dÃ©gradÃ©</span>
      <span class="value" id="m-bad">â€”</span>
    </div>
  </div>
</section>

<!-- CHART -->
<section class="card">
  <h2>Graphique</h2>
  <div class="chart-wrapper">
    <canvas id="analytics-chart"></canvas>
  </div>
</section>

{% endblock %} {% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="{{ url_for('static', filename='js/analytics.js') }}"></script>
{% endblock %}
