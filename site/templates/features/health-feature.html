{% extends "base.html" %}

{% block title %}Recommandations de Sant√© - Aerium{% endblock %}

{% block content %}
<style>
.feature-header {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    padding: 50px 40px;
    border-radius: 16px;
    color: white;
    margin-bottom: 40px;
    box-shadow: 0 8px 32px rgba(245, 87, 108, 0.4);
    text-align: center;
}

.feature-header h1 {
    margin: 0 0 15px 0;
    font-size: 2.8em;
    font-weight: 700;
    letter-spacing: -0.5px;
}

.feature-header p {
    margin: 0;
    opacity: 0.95;
    font-size: 1.15em;
    font-weight: 300;
}

.back-btn {
    display: inline-block;
    margin-bottom: 20px;
    color: rgba(255, 255, 255, 0.9);
    text-decoration: none;
    transition: all 0.3s ease;
    font-size: 0.95em;
}

.back-btn:hover {
    opacity: 0.7;
    transform: translateX(-5px);
}
</style>

<div class="feature-page health-page">
    <div class="feature-header">
        <a href="/" class="back-btn">‚Üê Retour √† l'accueil</a>
        <h1>‚ù§Ô∏è Sant√© & Recommandations</h1>
        <p>Conseils de sant√© personnalis√©s bas√©s sur vos niveaux de CO‚ÇÇ et la qualit√© de l'air</p>
    </div>

    <div class="feature-content">
        <!-- Health Score Section -->
        <section class="feature-section">
            <h2>üéØ Votre Score de Sant√©</h2>
            <p>√âvaluation g√©n√©rale de votre qualit√© de l'air et impact sur la sant√©</p>
            
            <div class="health-score-container">
                <div class="score-circle" id="score-circle">
                    <div class="score-value">--</div>
                    <div class="score-label">Score de Sant√©</div>
                </div>
                <div class="score-details">
                    <div class="detail-item">
                        <span class="detail-label">Niveau de CO‚ÇÇ</span>
                        <span class="detail-value" id="co2-level">--</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Statut</span>
                        <span class="detail-value" id="health-status">Chargement...</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Derni√®re Mise √† Jour</span>
                        <span class="detail-value" id="last-updated">√Ä l'instant</span>
                    </div>
                </div>
            </div>

            <button onclick="loadHealthScore()" class="btn btn-primary" style="margin-top: 20px;">Actualiser le Score</button>
        </section>

        <!-- Recommendations Section -->
        <section class="feature-section">
            <h2>üí° Recommandations Personnalis√©es</h2>
            <p>Actions que vous pouvez prendre pour am√©liorer votre qualit√© de l'air</p>
            
            <div class="control-group">
                <button onclick="loadRecommendations()" class="btn btn-primary">Charger les Recommandations</button>
            </div>

            <div id="recommendations-container" class="data-container">
                <div class="loading">Chargement des recommandations...</div>
            </div>
        </section>

        <!-- Health Tips Section -->
        <section class="feature-section">
            <h2>üìö Conseils et Informations de Sant√©</h2>
            <p>Apprenez-en plus sur le CO‚ÇÇ et son impact sur votre sant√©</p>
            
            <div class="tips-grid">
                <div class="tip-card">
                    <h3>üå± Quel est un Niveau de CO‚ÇÇ Sain?</h3>
                    <p><strong>Air ext√©rieur:</strong> ~400 ppm</p>
                    <p><strong>Int√©rieur id√©al:</strong> 400-600 ppm</p>
                    <p><strong>Acceptable:</strong> 600-1000 ppm</p>
                    <p><strong>Mauvais:</strong> 1000+ ppm</p>
                </div>

                <div class="tip-card">
                    <h3>üò¥ Effets du CO‚ÇÇ √âlev√©</h3>
                    <p>Un CO‚ÇÇ int√©rieur √©lev√© peut causer:</p>
                    <ul>
                        <li>Fonctions cognitives r√©duites</li>
                        <li>Fatigue et somnolence</li>
                        <li>Maux de t√™te</li>
                        <li>Difficult√©s √† se concentrer</li>
                    </ul>
                </div>

                <div class="tip-card">
                    <h3>üí® Comment R√©duire le CO‚ÇÇ</h3>
                    <ul>
                        <li>Ouvrir les fen√™tres r√©guli√®rement</li>
                        <li>Utiliser des purificateurs d'air avec r√©duction du CO‚ÇÇ</li>
                        <li>Am√©liorer les syst√®mes de ventilation</li>
                        <li>R√©duire l'occupation dans les espaces scell√©s</li>
                    </ul>
                </div>

                <div class="tip-card">
                    <h3>‚è∞ Quand Agir</h3>
                    <p><strong>600 ppm:</strong> Envisager la ventilation</p>
                    <p><strong>1000 ppm:</strong> Ventiler imm√©diatement</p>
                    <p><strong>1500+ ppm:</strong> Chercher l'air ext√©rieur</p>
                    <p class="warning">Alerter les autorit√©s si persistant</p>
                </div>
            </div>
        </section>

        <!-- Health Trends Section -->
        <section class="feature-section">
            <h2>üìà Vos Tendances de Sant√©</h2>
            <p>Consultez comment votre qualit√© de l'air a √©volu√© au fil du temps</p>
            
            <div class="control-group">
                <button onclick="loadTrends('week')" class="btn btn-small">Cette Semaine</button>
                <button onclick="loadTrends('month')" class="btn btn-small">Ce Mois</button>
                <button onclick="loadTrends('year')" class="btn btn-small">Cette Ann√©e</button>
            </div>

            <div id="trends-container" class="data-container">
                <div class="loading">Chargement des donn√©es de tendances...</div>
            </div>
        </section>

        <!-- Action Items Section -->
        <section class="feature-section">
            <h2>‚úÖ Plan d'Action</h2>
            <p>√âtapes recommand√©es pour am√©liorer votre qualit√© de l'air</p>
            
            <div class="action-items">
                <div class="action-item" onclick="toggleAction(this)">
                    <div class="action-checkbox">‚òê</div>
                    <div class="action-content">
                        <h4>Ventiler Votre Espace</h4>
                        <p>Ouvrir les fen√™tres ou activer la ventilation pour r√©duire les niveaux de CO‚ÇÇ</p>
                    </div>
                    <span class="action-priority">Priorit√©: √âlev√©e</span>
                </div>

                <div class="action-item" onclick="toggleAction(this)">
                    <div class="action-checkbox">‚òê</div>
                    <div class="action-content">
                        <h4>V√©rifier le Syst√®me CVC</h4>
                        <p>Assurer que votre syst√®me de chauffage/refroidissement fonctionne correctement</p>
                    </div>
                    <span class="action-priority">Priorit√©: Moyenne</span>
                </div>

                <div class="action-item" onclick="toggleAction(this)">
                    <div class="action-checkbox">‚òê</div>
                    <div class="action-content">
                        <h4>Installer un Moniteur de CO‚ÇÇ</h4>
                        <p>Obtenir un suivi en temps r√©el pour un meilleur contr√¥le</p>
                    </div>
                    <span class="action-priority">Priorit√©: Moyenne</span>
                </div>

                <div class="action-item" onclick="toggleAction(this)">
                    <div class="action-checkbox">‚òê</div>
                    <div class="action-content">
                        <h4>Maintenance R√©guli√®re</h4>
                        <p>Planifier l'entretien du CVC trimestriellement</p>
                    </div>
                    <span class="action-priority">Priorit√©: Basse</span>
                </div>
            </div>
        </section>
    </div>
</div>

<script>
function loadHealthScore() {
    fetch('/api/health/score')
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                const score = data.score || 75;
                const circle = document.getElementById('score-circle');
                const color = score > 80 ? '#4caf50' : score > 60 ? '#ff9800' : '#f44336';
                
                circle.style.borderColor = color;
                circle.querySelector('.score-value').textContent = score;
                document.getElementById('co2-level').textContent = data.co2_level || '--';
                document.getElementById('health-status').textContent = data.status || 'Bon';
                document.getElementById('last-updated').textContent = '√Ä l\'instant';
            }
        })
        .catch(e => console.error(e));
}

function loadRecommendations() {
    const container = document.getElementById('recommendations-container');
    container.innerHTML = '<div class="loading">Chargement des recommandations...</div>';
    
    fetch('/api/health/recommendations')
        .then(r => r.json())
        .then(data => {
            if (data.success && data.recommendations) {
                let html = '<div class="data-display">';
                html += '<div class="recommendations-list">';
                
                data.recommendations.forEach((rec, i) => {
                    const icon = rec.priority === 'high' ? 'üî¥' : rec.priority === 'medium' ? 'üü°' : 'üü¢';
                    const priorityText = rec.priority === 'high' ? 'HAUTE' : rec.priority === 'medium' ? 'MOYENNE' : 'BASSE';
                    const impactText = rec.impact || '√âlev√©';
                    html += `<div class="recommendation-item">
                        <span class="rec-icon">${icon}</span>
                        <div class="rec-content">
                            <h4>${rec.title}</h4>
                            <p>${rec.description}</p>
                            <div class="rec-footer">
                                <span class="rec-priority">${priorityText}</span>
                                <span class="rec-impact">Impact: ${impactText}</span>
                            </div>
                        </div>
                    </div>`;
                });
                
                html += '</div>';
                html += '</div>';
                container.innerHTML = html;
            } else {
                container.innerHTML = '<div class="error">Impossible de charger les recommandations</div>';
            }
        })
        .catch(e => {
            container.innerHTML = '<div class="error">Erreur: ' + e.message + '</div>';
        });
}

function loadTrends(period) {
    const container = document.getElementById('trends-container');
    const periodNames = { week: 'semaine', month: 'mois', year: 'ann√©e' };
    container.innerHTML = '<div class="loading">Chargement des tendances du ' + periodNames[period] + '...</div>';
    
    fetch('/api/health/trends?period=' + period)
        .then(r => r.json())
        .then(data => {
            if (data.success) {
                let html = '<div class="data-display">';
                const periodDisplay = period === 'week' ? 'Semaine' : period === 'month' ? 'Mois' : 'Ann√©e';
                html += '<h3>Tendances de Qualit√© de l\'Air - ' + periodDisplay + '</h3>';
                html += '<div class="trend-chart">';
                
                const points = [65, 70, 68, 75, 72, 78, 82, 80, 85, 88];
                let chart = '<svg width="100%" height="200" viewBox="0 0 300 150">';
                
                for (let i = 0; i < points.length - 1; i++) {
                    const x1 = (i / points.length) * 300;
                    const x2 = ((i + 1) / points.length) * 300;
                    const y1 = 150 - (points[i] / 100) * 130;
                    const y2 = 150 - (points[i + 1] / 100) * 130;
                    chart += `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="#4ecdc4" stroke-width="2"/>`;
                }
                
                chart += '</svg>';
                html += chart;
                html += '<div class="trend-stats">';
                html += '<p><strong>Score Moyen:</strong> 76%</p>';
                html += '<p><strong>Score Maximal:</strong> 88%</p>';
                html += '<p><strong>Tendance:</strong> ‚Üó S\'am√©liore</p>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                container.innerHTML = html;
            }
        })
        .catch(e => {
            container.innerHTML = '<div class="error">Erreur: ' + e.message + '</div>';
        });
}

function toggleAction(element) {
    element.classList.toggle('completed');
    const checkbox = element.querySelector('.action-checkbox');
    checkbox.textContent = element.classList.contains('completed') ? '‚úì' : '‚òê';
}

// Load initial data
window.addEventListener('load', () => {
    loadHealthScore();
    loadRecommendations();
    loadTrends('week');
});
</script>

<style>
.feature-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.feature-header {
    position: relative;
    margin-bottom: 40px;
    padding-bottom: 30px;
    border-bottom: 2px solid var(--border-light);
}

.back-btn {
    display: inline-block;
    color: var(--accent);
    text-decoration: none;
    margin-bottom: 15px;
    transition: all 0.3s ease;
}

.back-btn:hover {
    transform: translateX(-5px);
}

.feature-header h1 {
    font-size: 2.5em;
    margin: 10px 0 5px 0;
}

.feature-header p {
    color: var(--muted);
    font-size: 1.1em;
}

.feature-content {
    display: grid;
    gap: 40px;
}

.feature-section {
    background: var(--card);
    border: 2px solid var(--border-light);
    border-radius: 15px;
    padding: 30px;
}

.feature-section h2 {
    font-size: 1.8em;
    margin-bottom: 10px;
    color: var(--text);
}

.feature-section > p {
    color: var(--muted);
    margin-bottom: 25px;
    font-size: 1.05em;
}

.control-group {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    margin-bottom: 25px;
}

.btn {
    padding: 12px 25px;
    border: none;
    border-radius: 8px;
    font-size: 1em;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
}

.btn-primary {
    background: var(--accent);
    color: white;
}

.btn-primary:hover {
    background: var(--accent);
    transform: scale(1.05);
}

.btn-small {
    padding: 8px 16px;
    font-size: 0.9em;
}

.health-score-container {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 40px;
    align-items: center;
    padding: 30px;
    background: rgba(255,255,255,0.03);
    border-radius: 15px;
}

.score-circle {
    width: 180px;
    height: 180px;
    border: 8px solid #4caf50;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    transition: all 0.3s ease;
}

.score-value {
    font-size: 3em;
    font-weight: bold;
    color: var(--text);
}

.score-label {
    font-size: 0.9em;
    color: var(--muted);
    margin-top: 5px;
}

.score-details {
    display: grid;
    gap: 20px;
}

.detail-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--border-light);
}

.detail-item:last-child {
    border-bottom: none;
}

.detail-label {
    color: var(--muted);
    font-weight: 600;
}

.detail-value {
    color: var(--text);
    font-weight: bold;
}

.data-container {
    min-height: 200px;
}

.loading {
    text-align: center;
    padding: 40px 20px;
    color: var(--muted);
    font-size: 1.1em;
}

.recommendations-list {
    display: grid;
    gap: 15px;
}

.recommendation-item {
    display: flex;
    gap: 15px;
    padding: 20px;
    background: rgba(255,255,255,0.03);
    border-radius: 10px;
    border-left: 4px solid var(--accent);
}

.rec-icon {
    font-size: 1.5em;
    min-width: 30px;
    text-align: center;
}

.rec-content h4 {
    margin: 0 0 8px 0;
    color: var(--text);
}

.rec-content p {
    margin: 0 0 10px 0;
    color: var(--muted);
    line-height: 1.5;
}

.rec-footer {
    display: flex;
    gap: 15px;
}

.rec-priority,
.rec-impact {
    font-size: 0.85em;
    padding: 4px 10px;
    background: var(--accent);
    color: white;
    border-radius: 4px;
}

.tips-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.tip-card {
    background: rgba(255,255,255,0.03);
    padding: 20px;
    border-radius: 10px;
    border-left: 4px solid var(--accent);
}

.tip-card h3 {
    margin: 0 0 15px 0;
    color: var(--text);
}

.tip-card p {
    margin: 8px 0;
    color: var(--muted);
    line-height: 1.5;
}

.tip-card ul {
    margin: 10px 0;
    padding-left: 20px;
}

.tip-card li {
    margin: 5px 0;
    color: var(--muted);
}

.warning {
    color: #f44336;
    font-weight: 600;
}

.trend-chart {
    background: rgba(255,255,255,0.03);
    padding: 20px;
    border-radius: 10px;
    margin: 20px 0;
}

.trend-chart svg {
    width: 100%;
    height: auto;
    min-height: 200px;
}

.trend-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 20px;
}

.trend-stats p {
    margin: 0;
    color: var(--muted);
}

.trend-stats strong {
    color: var(--text);
}

.action-items {
    display: grid;
    gap: 15px;
}

.action-item {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 20px;
    background: rgba(255,255,255,0.03);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    border-left: 4px solid #ff9800;
}

.action-item:hover {
    background: var(--border-light);
    transform: translateX(5px);
}

.action-item.completed {
    border-left-color: #4caf50;
    opacity: 0.7;
}

.action-checkbox {
    font-size: 1.5em;
    min-width: 30px;
    text-align: center;
    color: #ff9800;
}

.action-item.completed .action-checkbox {
    color: #4caf50;
}

.action-content {
    flex: 1;
}

.action-content h4 {
    margin: 0 0 5px 0;
    color: var(--text);
}

.action-content p {
    margin: 0;
    color: var(--muted);
    font-size: 0.9em;
}

.action-priority {
    display: inline-block;
    font-size: 0.85em;
    padding: 4px 10px;
    background: var(--accent);
    color: white;
    border-radius: 4px;
    white-space: nowrap;
}

.error {
    padding: 20px;
    background: rgba(244, 67, 54, 0.1);
    border: 2px solid #f44336;
    border-radius: 8px;
    color: #c62828;
}

/* Dark Mode Support - Using Global Theme Variables */
html {
    color-scheme: light dark;
}

body {
    background: var(--bg);
    color: var(--text);
    transition: background-color 0.3s ease, color 0.3s ease;
}

.feature-page {
    background: var(--bg);
    color: var(--text);
}

@media (max-width: 768px) {
    .feature-header h1 {
        font-size: 1.8em;
    }

    .feature-section {
        padding: 20px;
    }

    .health-score-container {
        grid-template-columns: 1fr;
    }

    .score-circle {
        width: 140px;
        height: 140px;
    }

    .tips-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}
