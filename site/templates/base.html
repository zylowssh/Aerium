<!DOCTYPE html>
<html lang="fr" class="dark-mode">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Aerium - Surveillance intelligente de la qualitÃ© de l'air COâ‚‚ en temps rÃ©el" />
    <meta name="theme-color" content="#0b0d12" />
    <title>Aerium - QualitÃ© de l'air COâ‚‚</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <!-- Critical inline styles to prevent flash - applied before any external CSS -->
    <style>
      html, body {
        background-color: #0b0d12;
        color: #e1e8ed;
        margin: 0;
        padding: 0;
      }
      html.light-mode, html.light-mode body {
        background-color: #f8f9fa;
        color: #1a1f36;
      }
    </style>
    <link
      rel="icon"
      href="{{ url_for('static', filename='images/favicon.ico') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/profile-admin.css') }}"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
    <!-- Apply saved theme immediately to prevent flash of wrong theme -->
    <script>
      (function() {
        const savedTheme = localStorage.getItem('theme') || 'dark';
        const isLight = savedTheme === 'light';
        const root = document.documentElement;
        
        if (isLight) {
          root.classList.add('light-mode');
          root.classList.remove('dark-mode');
          root.style.setProperty('--bg', '#f8f9fa');
          root.style.setProperty('--bg-solid', '#f8f9fa');
          root.style.setProperty('--card', '#ffffff');
          root.style.setProperty('--card-solid', '#ffffff');
          root.style.setProperty('--text', '#1a1f36');
          root.style.setProperty('--muted', '#6c757d');
          root.style.setProperty('--good', '#28a745');
          root.style.setProperty('--medium', '#ffc107');
          root.style.setProperty('--bad', '#dc3545');
          root.style.setProperty('--accent', '#0066cc');
          root.style.setProperty('--accent-alt', '#004c99');
          root.style.setProperty('--gradient-primary', 'linear-gradient(135deg, #0066cc 0%, #004c99 100%)');
          root.style.setProperty('--border-light', 'rgba(0,102,204,0.15)');
          root.style.setProperty('--border-dark', 'rgba(0,102,204,0.08)');
          root.style.setProperty('--shadow-sm', '0 1px 3px rgba(0,0,0,0.08)');
          root.style.setProperty('--shadow-md', '0 4px 12px rgba(0,0,0,0.1)');
          root.style.setProperty('--shadow-lg', '0 8px 24px rgba(0,0,0,0.12)');
          root.style.setProperty('--shadow-accent', '0 4px 15px rgba(0,102,204,0.15)');
        } else {
          root.classList.add('dark-mode');
          root.classList.remove('light-mode');
        }
        
        // Set logo based on theme after DOM loads
        document.addEventListener('DOMContentLoaded', function() {
          const logoImg = document.getElementById('nav-logo-img');
          if (logoImg && isLight) {
            logoImg.src = logoImg.src.replace('logoWhite.png', 'logoBlack.png');
          }
        });
      })();
    </script>
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-left">
        <img
          id="nav-logo-img"
          src="{{ url_for('static', filename='images/logoWhite.png') }}"
          alt="Aerium"
          class="nav-logo"
        />
      </div>

      <div class="nav-center">
        <a href="/">ğŸ  Vue d'ensemble</a>
        <a href="/live">ğŸ“Š Live</a>
        <a href="/simulator">ğŸ”¬ Simulateur</a>
        <a href="/settings">âš™ï¸ ParamÃ¨tres</a>
        <a href="/visualization">ğŸ“ˆ Visualisations</a>
        <a href="/features-hub">âœ¨ FonctionnalitÃ©s</a>
        {% if session.get('username') %}
        <a href="{{ url_for('onboarding_page') }}">ğŸ“– Guide</a>
        {% endif %}
        {% if session.get('username') and is_admin %}
        <a href="/admin-tools">ğŸ› ï¸ Admin</a>
        {% endif %}
        <span class="nav-underline"></span>
      </div>

      <div class="nav-right">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" aria-label="Menu" aria-expanded="false">â˜°</button>
        <button id="theme-toggle-btn" class="theme-toggle" title="Basculer le thÃ¨me">
          <span class="theme-icon">ğŸŒ™</span>
        </button>
        <div class="nav-status" id="nav-analysis">
          <span class="dot"></span>
          <div class="nav-status-text">
            <span class="label" id="nav-analysis-label">Analyse active</span>
            <span class="sublabel" id="nav-transport-label">Live via WebSocket</span>
          </div>
        </div>
        <div class="nav-mini" id="nav-mini">
          <span class="nav-mini-value" id="nav-ppm-value">â€” ppm</span>
          <canvas id="nav-ppm-spark" width="160" height="48" aria-label="Historique COâ‚‚"></canvas>
        </div>
        {% if session.get('username') %}
        <div class="nav-user">
          <a href="{{ url_for('profile') }}" class="nav-profile-link" title="Profil">ğŸ‘¤ {{ session.get('username') }}</a>
          <a href="{{ url_for('logout') }}" class="nav-logout" title="DÃ©connexion">ğŸšª</a>
        </div>
        {% endif %}
      </div>
    </nav>

    <!-- Mobile Navigation Menu -->
    <div class="mobile-menu">
      <a href="/">ğŸ  Vue d'ensemble</a>
      <a href="/live">ğŸ“Š Live</a>
      <a href="/settings">âš™ï¸ ParamÃ¨tres</a>
      <a href="/features-hub">âœ¨ Features</a>
      {% if session.get('username') %}
      <hr style="border: none; border-top: 1px solid rgba(255, 255, 255, 0.1); margin: 10px 0;">
      <a href="{{ url_for('onboarding_page') }}">ğŸ“– Guide</a>
      {% if is_admin %}
      <a href="/simulator">ğŸ”¬ Simulateur</a>
      <a href="/admin-tools">ğŸ› ï¸ Outils Admin</a>
      {% endif %}
      <a href="{{ url_for('profile') }}">ğŸ‘¤ Profil</a>
      <a href="{{ url_for('logout') }}">ğŸšª DÃ©connexion</a>
      {% else %}
      <a href="{{ url_for('login_page') }}">ğŸ” Se connecter</a>
      <a href="{{ url_for('register_page') }}">ğŸ“ S'inscrire</a>
      {% endif %}
    </div>

    <main class="container">{% block content %}{% endblock %}</main>
    {% block scripts %}{% endblock %}

    <!-- Module Loading Order (DO NOT CHANGE) -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script defer src="{{ url_for('static', filename='js/mobile.js') }}"></script>
    <script defer src="{{ url_for('static', filename='js/websocket.js') }}"></script>
    <script defer src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script defer src="{{ url_for('static', filename='js/settings.js') }}"></script>
    <script defer src="{{ url_for('static', filename='js/live.js') }}"></script>
    <script defer src="{{ url_for('static', filename='js/overview.js') }}"></script>
    <script defer src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
