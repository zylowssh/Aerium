{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/collaboration.css') }}">

<div class="container">
    <div class="collab-header">
        <h1>üë• Collaboration d'√âquipe</h1>
            <p>Partagez les donn√©es, cr√©ez des alertes et collaborez en temps r√©el</p>
        </div>

        <div class="collaboration-tabs">
            <button class="tab-btn active" onclick="switchTab('shares')">Partages</button>
            <button class="tab-btn" onclick="switchTab('alerts')">Alertes Partag√©es</button>
            <button class="tab-btn" onclick="switchTab('comments')">Commentaires</button>
            <button class="tab-btn" onclick="switchTab('activity')">Activit√© d'√âquipe</button>
        </div>

        <!-- Tab: Shares -->
        <div id="shares" class="tab-content active">
            <section class="card">
                <div class="section-header">
                    <h2>Tableaux de Bord Partag√©s</h2>
                    <button class="btn btn-primary" onclick="openShareModal()">
                        ‚ûï Partager un Capteur
                    </button>
                </div>

                <div class="shares-grid" id="sharesGrid">
                    <p class="loading">Chargement des partages...</p>
                </div>
            </section>
        </div>

        <!-- Tab: Alerts -->
        <div id="alerts" class="tab-content">
            <section class="card">
                <div class="section-header">
                    <h2>Alertes Partag√©es avec l'√âquipe</h2>
                    <button class="btn btn-primary" onclick="openAlertModal()">
                        üîî Cr√©er une Alerte
                    </button>
                </div>

                <div class="alerts-list" id="alertsList">
                    <p class="loading">Chargement des alertes...</p>
                </div>
            </section>
        </div>

        <!-- Tab: Comments -->
        <div id="comments" class="tab-content">
            <section class="card">
                <h2>Commentaires et Annotations</h2>
                <div class="comments-section">
                    <div class="form-group">
                        <label>S√©lectionner une Lecture</label>
                        <input type="number" id="readingIdSelect" placeholder="ID de la lecture">
                        <button class="btn btn-secondary" onclick="loadReadingComments()">
                            Charger
                        </button>
                    </div>

                    <div class="comments-container" id="commentsContainer">
                        <p class="text-muted">S√©lectionnez une lecture</p>
                    </div>

                    <div class="add-comment-form">
                        <h3>Ajouter un Commentaire</h3>
                        <div class="form-group">
                            <textarea id="commentText" placeholder="√âcrivez votre commentaire..."></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="addComment()">
                            Poster Commentaire
                        </button>
                    </div>
                </div>
            </section>
        </div>

        <!-- Tab: Activity -->
        <div id="activity" class="tab-content">
            <section class="card">
                <h2>Fil d'Activit√© de l'√âquipe</h2>
                <div class="activity-filters">
                    <select id="activityFilter" onchange="filterActivity()">
                        <option value="">Tous les √©v√©nements</option>
                        <option value="anomaly">Anomalies D√©tect√©es</option>
                        <option value="alert">Alertes D√©clench√©es</option>
                        <option value="comment">Commentaires Ajout√©s</option>
                        <option value="share">Partages Cr√©√©s</option>
                    </select>
                </div>

                <div class="activity-feed" id="activityFeed">
                    <p class="loading">Chargement de l'activit√©...</p>
                </div>
            </section>
        </div>

        <!-- Team Statistics -->
        <section class="team-stats">
            <h2>üìà Statistiques de l'√âquipe</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Membres Actifs</h3>
                    <p class="stat-value" id="activeMembers">5</p>
                </div>
                <div class="stat-card">
                    <h3>Alertes Actives</h3>
                    <p class="stat-value" id="activeAlerts">8</p>
                </div>
                <div class="stat-card">
                    <h3>Commentaires (30j)</h3>
                    <p class="stat-value" id="recentComments">24</p>
                </div>
                <div class="stat-card">
                    <h3>√âv√©nements (7j)</h3>
                    <p class="stat-value" id="recentEvents">143</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Modals -->
    <div id="shareModal" class="modal">
        <div class="modal-content">
            <h2>Partager un Tableau de Bord</h2>
            <div class="form-group">
                <label>S√©lectionner un Capteur</label>
                <select id="shareSensorSelect">
                    <option value="">Choisir un capteur...</option>
                </select>
            </div>
            <div class="form-group">
                <label>Membres de l'√âquipe</label>
                <div id="teamMembersCheckbox">
                    <!-- Checkboxes g√©n√©r√©es dynamiquement -->
                </div>
            </div>
            <div class="form-group">
                <label>Niveau de Permission</label>
                <select id="sharePermission">
                    <option value="viewer">Spectateur (lecture seule)</option>
                    <option value="commenter">Commentateur (peut commenter)</option>
                    <option value="editor">√âditeur (peut modifier les alertes)</option>
                </select>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('shareModal')">Annuler</button>
                <button class="btn btn-primary" onclick="createShare()">Partager</button>
            </div>
        </div>
    </div>

    <div id="alertModal" class="modal">
        <div class="modal-content">
            <h2>Cr√©er une Alerte d'√âquipe</h2>
            <div class="form-group">
                <label>Partage (Capteur Partag√©)</label>
                <select id="alertShareSelect">
                    <option value="">Choisir un partage...</option>
                </select>
            </div>
            <div class="form-group">
                <label>Nom de l'Alerte</label>
                <input type="text" id="alertName" placeholder="CO‚ÇÇ √âlev√©">
            </div>
            <div class="form-group">
                <label>Condition</label>
                <select id="alertCondition">
                    <option value="ppm > 800">PPM > 800</option>
                    <option value="ppm > 1000">PPM > 1000</option>
                    <option value="ppm < 400">PPM < 400</option>
                </select>
            </div>
            <div class="form-group">
                <label>Notifier les Membres</label>
                <div id="alertMembersCheckbox">
                    <!-- Checkboxes g√©n√©r√©es dynamiquement -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('alertModal')">Annuler</button>
                <button class="btn btn-primary" onclick="createAlert()">Cr√©er Alerte</button>
            </div>
        </div>
    </div>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/collaboration.js') }}"></script>
{% endblock %}
