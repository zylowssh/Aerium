{% extends "base.html" %} {% block content %}

<div class="settings-container">
  <!-- Sidebar Navigation -->
  <aside class="settings-sidebar">
    <div class="settings-header">
      <h2>âš™ï¸ ParamÃ¨tres</h2>
    </div>
    <nav class="settings-nav">
      <button class="settings-nav-item active" data-tab="account">
        <span class="icon">ğŸ‘¤</span>
        <span>Compte</span>
      </button>
      <button class="settings-nav-item" data-tab="appearance">
        <span class="icon">ğŸ¨</span>
        <span>Apparence</span>
      </button>
      <button class="settings-nav-item" data-tab="personalization">
        <span class="icon">âš™ï¸</span>
        <span>Personnalisation</span>
      </button>
      <button class="settings-nav-item" data-tab="simulation">
        <span class="icon">â–¶ï¸</span>
        <span>Simulation</span>
      </button>
      <button class="settings-nav-item" data-tab="thresholds">
        <span class="icon">ğŸ“Š</span>
        <span>Seuils COâ‚‚</span>
      </button>
      <button class="settings-nav-item" data-tab="database">
        <span class="icon">ğŸ—„ï¸</span>
        <span>Base de donnÃ©es</span>
      </button>
      <button class="settings-nav-item" data-tab="data">
        <span class="icon">ğŸ’¾</span>
        <span>DonnÃ©es</span>
      </button>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="settings-content">
    <!-- ACCOUNT SETTINGS TAB -->
    <section class="settings-panel active" id="account-panel">
      <h2>ParamÃ¨tres du compte</h2>
      
      <!-- Account Information -->
      <div class="card">
        <h3>Informations du compte</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
          <div>
            <label style="display: block; color: #9ca3af; font-size: 0.85rem; margin-bottom: 5px;">Nom d'utilisateur</label>
            <div style="font-size: 1.1rem; color: #e5e7eb; font-weight: 600;" id="account-username">-</div>
          </div>
          <div>
            <label style="display: block; color: #9ca3af; font-size: 0.85rem; margin-bottom: 5px;">Email</label>
            <div style="font-size: 1.1rem; color: #e5e7eb; font-weight: 600;" id="account-email">-</div>
          </div>
          <div>
            <label style="display: block; color: #9ca3af; font-size: 0.85rem; margin-bottom: 5px;">RÃ´le</label>
            <div style="font-size: 1.1rem; color: #e5e7eb; font-weight: 600;" id="account-role">-</div>
          </div>
          <div>
            <label style="display: block; color: #9ca3af; font-size: 0.85rem; margin-bottom: 5px;">Statut</label>
            <div style="font-size: 1rem; color: #4ade80;">âœ“ Actif</div>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>Changer le mot de passe</h3>
        <div class="form-group">
          <label for="current-password">Mot de passe actuel</label>
          <input type="password" id="current-password" placeholder="Entrez votre mot de passe actuel">
        </div>
        <div class="form-group">
          <label for="new-password">Nouveau mot de passe</label>
          <input type="password" id="new-password" placeholder="Entrez un nouveau mot de passe">
        </div>
        <div class="form-group">
          <label for="confirm-password">Confirmer le mot de passe</label>
          <input type="password" id="confirm-password" placeholder="Confirmez le nouveau mot de passe">
        </div>
        <button id="change-password-btn" class="btn-save">ğŸ” Changer le mot de passe</button>
      </div>
    </section>

    <!-- APPEARANCE SETTINGS TAB -->
    <section class="settings-panel" id="appearance-panel">
      <h2>Apparence</h2>
      
      <div class="card">
        <h3>Alertes audio</h3>
        <div class="switch-row">
          <span class="switch-label">Activer les alertes audio</span>
          <label class="toggle">
            <input type="checkbox" id="toggle-audio-alerts" checked />
            <span class="track">
              <span class="thumb"></span>
            </span>
          </label>
        </div>
        <p class="hint">Son lors du dÃ©passement des seuils COâ‚‚</p>
      </div>
    </section>

    <!-- PERSONALIZATION SETTINGS TAB -->
    <section class="settings-panel" id="personalization-panel">
      <h2>âš™ï¸ Configuration du Tableau de Bord</h2>
      <p class="hint">Personnalisez la disposition et les mÃ©triques de votre tableau de bord</p>
      
      <div class="card">
        <h3>Widgets du tableau de bord</h3>
        <div style="margin: 20px 0;">
          <button onclick="loadDashboardConfig()" class="btn-save">Charger la Configuration</button>
        </div>

        <div id="dashboard-config-container" style="min-height: 200px;">
          <div style="text-align: center; padding: 40px; color: #9ca3af;">Cliquez sur "Charger" pour voir la configuration</div>
        </div>
      </div>

      <div class="card">
        <h3>PrÃ©fÃ©rences d'affichage</h3>
        <div class="switch-row">
          <span class="switch-label">Afficher les graphiques en temps rÃ©el</span>
          <label class="toggle">
            <input type="checkbox" id="toggle-realtime-charts" checked />
            <span class="track">
              <span class="thumb"></span>
            </span>
          </label>
        </div>
        <div class="switch-row" style="margin-top: 12px;">
          <span class="switch-label">Actualisation automatique</span>
          <label class="toggle">
            <input type="checkbox" id="toggle-auto-refresh" checked />
            <span class="track">
              <span class="thumb"></span>
            </span>
          </label>
        </div>
      </div>
    </section>

    <!-- SIMULATION SETTINGS TAB -->
    <section class="settings-panel" id="simulation-panel">
      <h2>ParamÃ¨tres de simulation</h2>
      
      <div class="card">
        <h3>Mode de simulation</h3>
        <div class="switch-row">
          <span class="switch-label">Mode rÃ©aliste</span>
          <label class="toggle">
            <input type="checkbox" id="realistic-mode" checked />
            <span class="track">
              <span class="thumb"></span>
            </span>
          </label>
        </div>
        <p class="hint">Simule des variations naturelles du COâ‚‚</p>
      </div>

      <div class="card">
        <h3>Vitesse de mise Ã  jour (Live)</h3>
        <div class="slider-item">
          <label for="update-speed" class="slider-label">Ajuster la vitesse</label>
          <input
            type="range"
            id="update-speed"
            min="1"
            max="10"
            value="1"
            step="0.5"
          />
          <div class="slider-values">
            <span>1s</span>
            <span id="speed-value" class="slider-current">1 seconde</span>
            <span>10s</span>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>Vitesse de mise Ã  jour (Vue d'ensemble)</h3>
        <div class="slider-item">
          <label for="overview-update-speed" class="slider-label">Ajuster la vitesse</label>
          <input
            type="range"
            id="overview-update-speed"
            min="2"
            max="30"
            value="5"
            step="1"
          />
          <div class="slider-values">
            <span>2s</span>
            <span id="overview-speed-value" class="slider-current">5 secondes</span>
            <span>30s</span>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>Analyse en direct</h3>
        <div class="switch-row" style="margin-bottom: 0;">
          <span class="switch-label">Analyse en direct</span>
          <label class="toggle">
            <input type="checkbox" id="toggle-analysis" checked />
            <span class="track">
              <span class="thumb"></span>
            </span>
          </label>
        </div>
        <p id="status-text" class="status-text" style="margin-top: 12px; color: var(--muted); font-size: 0.9rem;"></p>
      </div>
    </section>

    <!-- THRESHOLDS SETTINGS TAB -->
    <section class="settings-panel" id="thresholds-panel">
      <h2>Seuils d'alerte COâ‚‚</h2>

      <div class="card">
        <h3>PrÃ©sets rapides</h3>
        <p style="font-size: 0.85rem; color: var(--muted); margin-bottom: 8px;">SÃ©lectionner une configuration</p>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
          <button class="preset-btn" data-preset="office">ğŸ¢ Bureau</button>
          <button class="preset-btn" data-preset="school">ğŸ“ Ã‰cole</button>
          <button class="preset-btn" data-preset="strict">ğŸ”’ Strict</button>
        </div>
      </div>

      <div class="card">
        <h3>Configuration personnalisÃ©e</h3>
        <div class="slider-group">
          <div class="slider-item">
            <label for="good-threshold" class="slider-label">ğŸŸ¢ Seuil Bon (ppm)</label>
            <input
              type="range"
              id="good-threshold"
              min="400"
              max="1200"
              step="10"
              value="800"
            />
            <div class="slider-values">
              <span>400</span>
              <span id="good-value" class="slider-current">800 ppm</span>
              <span>1200</span>
            </div>
            <p class="hint">En dessous: Air acceptable</p>
          </div>

          <div class="slider-item">
            <label for="warning-threshold" class="slider-label">ğŸŸ¡ Seuil Alerte (ppm)</label>
            <input
              type="range"
              id="warning-threshold"
              min="800"
              max="1400"
              step="10"
              value="1000"
            />
            <div class="slider-values">
              <span>800</span>
              <span id="warning-value" class="slider-current">1000 ppm</span>
              <span>1400</span>
            </div>
            <p class="hint">Entre bon et critique: Augmenter ventilation</p>
          </div>

          <div class="slider-item">
            <label for="critical-threshold" class="slider-label">ğŸ”´ Seuil Critique (ppm)</label>
            <input
              type="range"
              id="critical-threshold"
              min="1000"
              max="2000"
              step="10"
              value="1200"
            />
            <div class="slider-values">
              <span>1000</span>
              <span id="critical-value" class="slider-current">1200 ppm</span>
              <span>2000</span>
            </div>
            <p class="hint">Au-dessus: Air dangereux, aÃ©ration urgente</p>
          </div>
        </div>

        <div class="threshold-visual">
          <p style="font-size: 0.8rem; color: var(--muted); margin-bottom: 10px;">RÃ©partition des zones</p>
          <div class="threshold-bar">
            <div id="good-segment" class="threshold-segment good-seg">âœ“ Bon</div>
            <div id="warning-segment" class="threshold-segment warning-seg">âš  Alerte</div>
            <div id="critical-segment" class="threshold-segment bad-seg">ğŸ”´ Critique</div>
          </div>
        </div>
      </div>
    </section>

    <!-- DATABASE SETTINGS TAB -->
    <section class="settings-panel" id="database-panel">
      <h2>Gestion de la base de donnÃ©es</h2>

      <div class="card">
        <h3>Informations de la base de donnÃ©es</h3>
        <div id="db-info" style="background: var(--card); padding: 12px; border-radius: 6px; font-family: monospace; font-size: 0.9rem; color: var(--muted);">
          <p>Chargement...</p>
        </div>
      </div>

      <div class="card">
        <h3>Tables et schÃ©ma</h3>
        <div id="db-schema" style="background: var(--card); padding: 12px; border-radius: 6px; max-height: 400px; overflow-y: auto;">
          <p>Chargement...</p>
        </div>
      </div>

      <div class="card">
        <h3>Gestion des donnÃ©es</h3>
        <p style="color: var(--muted); margin-bottom: 12px; font-size: 0.9rem;">CrÃ©er des sauvegardes et restaurer les donnÃ©es</p>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
          <button id="backup-db-btn" class="btn-save">ğŸ’¾ CrÃ©er une sauvegarde</button>
          <button id="restore-db-btn" class="link" style="background: rgba(102, 126, 234, 0.15); color: #667eea; border: 1px solid rgba(102, 126, 234, 0.4);">ğŸ“¥ Restaurer</button>
        </div>
      </div>
    </section>

    <!-- DATA SETTINGS TAB -->
    <section class="settings-panel" id="data-panel">
      <h2>Gestion des donnÃ©es</h2>

      <div class="card">
        <h3>RÃ©tention des donnÃ©es</h3>
        <div class="slider-item">
          <label for="retention-days" class="slider-label">Conserver les donnÃ©es</label>
          <input
            type="range"
            id="retention-days"
            min="7"
            max="365"
            value="90"
            step="1"
          />
          <div class="slider-values">
            <span>7j</span>
            <span id="retention-value" class="slider-current">90 jours</span>
            <span>365j</span>
          </div>
          <p class="hint" id="retention-hint" style="margin-top: 8px;">Environ â€” lignes</p>
        </div>
      </div>

      <div class="card">
        <h3>Nettoyage</h3>
        <p style="color: var(--muted); margin-bottom: 12px; font-size: 0.9rem;">Supprimer les donnÃ©es anciennes</p>
        <button id="cleanup-btn" class="link" style="background: rgba(248,113,113,0.15); color: #f87171; border: 1px solid rgba(248,113,113,0.4); margin-bottom: 12px;">ğŸ—‘ï¸ Nettoyer maintenant</button>
      </div>

      <div class="card">
        <h3>Actions</h3>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
          <button id="export-data-btn" class="btn-save">ğŸ“¤ Exporter les donnÃ©es</button>
          <button id="reset-settings" class="link" style="background: rgba(248,113,113,0.15); color: #f87171; border: 1px solid rgba(248,113,113,0.4);">âŸ² RÃ©initialiser</button>
        </div>
      </div>
    </section>

    <!-- Action Buttons -->
    <div class="action-buttons" style="margin-top: 32px;">
      <button id="save-settings" class="btn-save">ğŸ’¾ Enregistrer les modifications</button>
      <a href="/live" class="link" style="text-align: center;">â† Retour au tableau de bord</a>
    </div>
  </main>
</div>

<div id="toast-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: none;">
  <div id="toast" style="background: #4ade80; color: #0b0d12; padding: 12px 16px; border-radius: 8px; font-weight: 600; min-width: 200px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.4);"></div>
</div>

<script>
// Dashboard Configuration Function
function loadDashboardConfig() {
    const container = document.getElementById('dashboard-config-container');
    container.innerHTML = '<div style="text-align: center; padding: 40px; color: #9ca3af;">Chargement de la configuration...</div>';
    
    fetch('/api/visualization/dashboard-config')
        .then(r => r.json())
        .then(data => {
            if (data.success && data.widgets) {
                let html = '<div style="display: grid; gap: 15px;">';
                
                data.widgets.forEach(widget => {
                    html += '<div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 8px; border-left: 4px solid var(--accent);">';
                    html += '<div style="display: flex; align-items: center; gap: 15px;">';
                    html += '<span style="font-size: 1.5em;">' + widget.icon + '</span>';
                    html += '<span style="font-weight: 500;">' + widget.name + '</span>';
                    html += '</div>';
                    html += '<label class="toggle">';
                    html += '<input type="checkbox" ' + (widget.enabled ? 'checked' : '') + '>';
                    html += '<span class="track"><span class="thumb"></span></span>';
                    html += '</label>';
                    html += '</div>';
                });
                
                html += '</div>';
                html += '<button class="btn-save" style="margin-top: 20px; width: 100%;">ğŸ’¾ Enregistrer la Configuration</button>';
                container.innerHTML = html;
            } else {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #f87171;">Impossible de charger la configuration</div>';
            }
        })
        .catch(e => {
            container.innerHTML = '<div style="text-align: center; padding: 40px; color: #f87171;">Erreur: ' + e.message + '</div>';
        });
}
</script>

{% endblock %}